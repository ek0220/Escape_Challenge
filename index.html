<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESCAPE CHALLENGE</title>
  <style>
    body { padding: 20px; font-family: Arial, sans-serif; text-align: center; }
    table { border-collapse: collapse; margin: auto; width: 80%; }
    th, td { border: 1px solid black; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    input { padding: 5px; margin: 5px; }
    #totalPoints { font-weight: bold; font-size: 18px; }
  </style>
</head>
<body>

  <h1>ESCAPE CHALLENGE</h1>

  <form id="challengeForm">
    <label>Team No.: </label>
    <input type="number" id="teamNo" name="teamNo" min="1" required><br>

    <label>Company Name: </label>
    <input type="text" id="companyName" name="companyName" required><br><br>

    <table>
      <thead>
        <tr>
          <th>Activity</th>
          <th>Points</th>
          <th>No. of Pax</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td>Monkey Business - Lvl 1</td><td>1</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Monkey Business - Lvl 2</td><td>2</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Monkey Business - Lvl 3</td><td>3</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Atan's Leap</td><td>2</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Gecko Tower - Lvl 1</td><td>1</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Gecko Tower - Lvl 2</td><td>2</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Aerobat - Basic Swing</td><td>1</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Aerobat - Knee Hang</td><td>1</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
        <tr><td>Aerobat - Backflip</td><td>1</td><td><input type="number" min="0" max="20" value="0" class="pax"></td></tr>
      </tbody>
    </table>

    <p>Total Points: <span id="totalPoints">0</span></p>
    <button type="submit">Submit</button>
  </form>

  <script>
    const tableBody = document.getElementById("tableBody");
    const totalPointsCell = document.getElementById("totalPoints");

    // Recalculate total when user changes Pax
    tableBody.addEventListener("input", () => {
      let total = 0;
      document.querySelectorAll("#tableBody tr").forEach(row => {
        const points = parseInt(row.cells[1].innerText);
        const pax = parseInt(row.querySelector(".pax").value) || 0;
        total += points * pax;
      });
      totalPointsCell.textContent = total;
    });

    // Handle submit
    document.getElementById("challengeForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const teamNo = document.getElementById("teamNo").value;
      const companyName = document.getElementById("companyName").value;
      const totalPoints = totalPointsCell.textContent;

      const formData = new FormData();
      formData.append("teamNo", teamNo);
      formData.append("companyName", companyName);
      formData.append("totalPoints", totalPoints);

      // Add activity rows
      document.querySelectorAll("#tableBody tr").forEach((row, index) => {
        const activity = row.cells[0].innerText;
        const pts = row.cells[1].innerText;
        const pax = row.querySelector(".pax").value;
        formData.append(`activity_${index}`, activity);
        formData.append(`pts_${index}`, pts);
        formData.append(`pax_${index}`, pax);
      });

      // üîó Replace with your actual Google Apps Script Web App URL
      const scriptURL = "https://script.google.com/macros/s/AKfycbxQTSqYQvj1f6BOYK-flLnD9BV3Sy6w1B0RbrUqGUFtH7GfVwhZuNOlGuaUCKRFE8t3/exec";

      fetch(scriptURL, { method: "POST", body: formData })
        .then(res => res.text())
        .then(result => {
          if (parseInt(totalPoints) > 0) {
            window.location.href = "success.html";  // GitHub Pages file
          } else {
            window.location.href = "fail.html";     // GitHub Pages file
          }
        })
        .catch(err => {
          console.error("Error:", err);
          alert("‚ùå Failed to send data.");
        });
    });
  </script>
</body>
</html>
